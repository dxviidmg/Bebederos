{%extends 'base.html'%}

{%block content%}

	<h1>Avance de escuelas {%if request.user.perfil.tipo != "SI"%} de {{entidad.nombre}}{%endif%}</h1>
	
	{%if request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "IMTA"%}
	<p><a href="{%url 'accounts:ListViewPartidas' entidad.partida.numero%}">Regresar</a></p>
	{%endif%}
	<div class="table-responsive">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Zona</th>
					<th>Municipio</th>
					<th>Localidad</th>
					<th>C. C. T</th>
					<th>Nombre</th>
					<th>Nivel educativo</th>

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Mueble</th>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Sistema de potabilización</th>
					{%endif%}					
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Primer prueba (SI)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Primer prueba (LAB)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<th>Primer prueba (PQ)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Primer prueba (IMTA)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}	
					<th>Status de primer prueba</th>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Inicio de trabajo</th>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"  or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM"%}
					<th>Visita de acuerdos</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"  or request.user.perfil.tipo == "PM"%}
					<th>Manufactura (PQ)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Manufactura (GP)</th>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM"%}
					<th>Manufactura (Trazabilidad)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Construcción</th>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<th>Etapa de construcción</th>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<th>Segunda prueba (SI)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<th>Segunda prueba (Lab)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<th>Segunda prueba (PQ)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Segunda prueba (IMTA)</th>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<th>Status de segunda prueba</th>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Inicio de funcionamiento</th>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Mantenimientos</th>
					{%endif%}

					{%if request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Acta de entrega</th>
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<th>Expediente técnico</th>
					{%endif%}
					{%endif%}
				</tr>
			</thead>
			<tbody>
	{%for avanceEscuela in AvancePorEscuelas%}
				<tr>
					<td style="background-color: {{avanceEscuela.escuela.perfil.municipio.zona.color}};">
					{{avanceEscuela.escuela.perfil.municipio.zona.nombre}}
					</td>
					<td>{{avanceEscuela.escuela.perfil.municipio.nombre}}</td>
					<td>{{avanceEscuela.escuela.perfil.localidad}}</td>
					<td><a href="{%url 'accounts:DetailViewEscuela' avanceEscuela.escuela.perfil.pk%}">{{avanceEscuela.escuela.username}}</a></td>
					
					<td>{{avanceEscuela.escuela.get_full_name}}</td>
					<td>{{avanceEscuela.escuela.perfil.nivel_educativo}}</td>

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.sistemaBebedero.mueble%}{{avanceEscuela.sistemaBebedero.mueble}}{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.sistemaBebedero.sistema_potabilizacion%}{{avanceEscuela.sistemaBebedero.sistema_potabilizacion}}{%endif%}</td>
					{%endif%}					

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.primerPrueba.reporte_toma_agua%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.primerPrueba.no_registro%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<td>{%if avanceEscuela.primerPrueba.propuesta_sistema_potabilizador%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.primerPrueba.dictamen_sistema_potabilizador%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<td>{{avanceEscuela.primerPrueba.aprobacion}}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.inicioDeTrabajo%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM"%}
					<td>{%if avanceEscuela.visitaDeAcuerdo%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PM"%}
					<td>{%if avanceEscuela.sistemaBebedero.etapas_sp%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.sistemaBebedero.linea_ensamblaje%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM"%}
					<td>{%if avanceEscuela.sistemaBebedero.asignacion%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.evidencias%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}
					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<td>{%if avanceEscuela.escuela.perfil.avance == 100%}Finalizada{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<td>{%if avanceEscuela.segundaPrueba.reporte_toma_agua%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "PQ"%}
					<td>{%if avanceEscuela.segundaPrueba.no_registro%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<td>{%if avanceEscuela.segundaPrueba.resultados_laboratorio%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.segundaPrueba.dictamen_validacion%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "IMTA"%}
					<td>{{avanceEscuela.segundaPrueba.aprobacion}}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{% if avanceEscuela.inicioFuncionamiento%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.mantenimientos%}{{avanceEscuela.mantenimientos.count}}{%endif%}</td>
					{%endif%}

					{%if request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal"%}
					<td>{%if avanceEscuela.actaEntrega%}<i class="fa fa-check" aria-hidden="true"></i>{%endif%}</td>
					<td><a href="{%url 'accounts:ExportExpedienteZIP' avanceEscuela.escuela.pk%}">{%if avanceEscuela.inicioFuncionamiento%}Descargar{%endif%}</a></td>
					{%endif%}
				</tr>

	{%empty%}
				<tr>
					<td colspan="29">No hay datos para mostrar</td>
				</tr>
	{%endfor%}
		
			</tbody>
		</table>
	</div>

	{%if request.user.perfil.tipo == "Administrador" or "Pilar" in request.user.first_name%}

	<div class="table-responsive espacio2">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th colspan="4">Descarga masiva de documentos</th>
				</tr>
			</thead>
			<tbody>
				<tr>

					{%if request.user.perfil.tipo == "Administrador"%}

					<td><a href="{%url 'visitas:ExportCedulasIdentificacionZIP' entidad.pk%}">Cédulas de identificación</a></td>
					<td><a href="{%url 'visitas:ExportPlanosConjuntoZIP' entidad.pk%}">Planos de conjunto</a></td>
					<td><a href="{%url 'visitas:ExportDistribucionesPlantaZIP' entidad.pk%}">Distribuciones de planta</a></td>
					<td><a href="{%url 'visitas:ExportMemoriasCalculoZIP' entidad.pk%}">Memorias cálculo</a></td>			
				</tr>
				<tr>
					<td><a href="{%url 'visitas:ExportPlanosInstalacionElectricaZIP' entidad.pk%}">Planos de instalación eléctrica</a></td>
					<td><a href="{%url 'visitas:ExportPlanosInstalacionHidraculicaZIP' entidad.pk%}">Planos de instalación hidráulica</a></td>
					<td><a href="{%url 'visitas:ExportPlanosInstalacionSanitariaZIP' entidad.pk%}">Planos de instalación sanitaria</a></td>
					<td><a href="{%url 'visitas:ExportActasFuncionamietoZIP' entidad.pk%}">Actas de inicio de funcionamieto</a></td>
					
					{%endif%}
					{%if "Pilar" in request.user.first_name%}
					<td>
					<a href="{% url 'pruebas:ExportPruebasPorEscuelasCSV' entidad.pk%}">Base de formato T7</a>
					</td>
					{%endif%}

					
				</tr>
			</tbody>
		</table>
	</div>
	{%endif%}


{%endblock content%}