{%extends 'base.html'%}

{%load bootstrap%}

{%block content%}

	<style type="text/css">
		.titulo-tabla {
			background-color: #44B036;
			font-weight: bold;
		}
		.dummy {
			margin-top: 100%;
		}
		.thumbnail {
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			text-align:center;
			display: flex;
			align-items: center;
			justify-content: center;
			border: solid black 0.5px;
			background-color: #eeeee1;
			color: black;
		}
		.thumbnail:hover {
			color: #848484;
		}
		.thumbnail-inprogress {
			background-color: #DFF336;
			color: black;
		}
		.thumbnail-inprogress:hover {
			background-color: #D2E532 ;
			color: black;
		}
		.thumbnail-available {
			background-color: #44B036;
			color: white;
		}
		.thumbnail-available:hover {
			background-color: #197D0E;
			color: white;
		}
		.thumbnail-prueba-en-espera {
			background-color: yellow;
			color: black;
		}
		.thumbnail-prueba-en-espera:hover {
			background-color: #E5BB31;
			color: black;
		}
		.thumbnail-prueba-aprobado {
			background-color: green;
			color: white;
		}
		.thumbnail-prueba-aprobado:hover {
			background-color: #006600;
			color: white;
		}
		.thumbnail-prueba-no-aprobado {
			background-color: red;
			color: white;
		}
		.thumbnail-prueba-no-aprobado:hover {
			background-color: #F00000 ;
			color: white;
		}
	</style>

	<div class="row">
		<div class="col-lg-12 col-md-12 col-sm-12 col-12">
			<h1>{{escuela.get_full_name}}</h1>

			{%if request.user.perfil.tipo != "Laboratorio" or request.user.perfil.tipo != "CEstatal"%}
			<p><a href="{%url 'accounts:ListViewEscuelas' municipio.pk%}">Regresar a zona</a></p>
			{%endif%}
			{%if request.user.perfil.tipo == "SI"%}
			<p><a href="{%url 'accounts:ListViewAvanceEscuelasPorZona' request.user.superintendente.pk%}">Regresar a lista de escuelas</a></p>
			{%elif request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Administrador"%}
			<p><a href="{%url 'accounts:ListViewAvanceEscuelas' entidad.pk%}">Regresar a lista de escuelas</a></p>			
			{%endif%}


			{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador"%}
			<br>
			<a href="{%url 'accounts:UpdateViewEscuela' perfil.pk%}">Actualizar datos</a>
			<br>
			{%endif%}
		
		{%if request.user.perfil.tipo != "Escuela"%}
		
			<h3>Información de la institución</h3>

			<!--Tabla de Información de la escuela-->
		
			<div class="table-responsive text-center">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th colspan="12">CCT</th>
							<th colspan="12">Nombre</th>
							<th colspan="12">Nivel educativo</th>
							<th colspan="12">Status</th>
							<th colspan="12">Avance</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="12">{{escuela.username}}</td>
							<td colspan="12">{{escuela.get_full_name}}</td>
							<td colspan="12">{{perfil.nivel_educativo}}</td>
							<td colspan="12">{%if perfil.status%}{{perfil.status}}{%else%}Pendiente{%endif%}</td>
							<td colspan="12">{%if perfil.avance%}{{perfil.avance}}%{%endif%}</td>
						</tr>
					</tbody>
					<thead>
						<tr>
							<th colspan="15">Turno</th>
							<th colspan="15">Matricula</th>
							<th colspan="15">Director</th>
							<th colspan="15">Foto</th>
						</tr>
					</thead>
					<tbody>
					<tr>
						<td colspan="15">{%if perfil.turno%}{{perfil.turno}}{%endif%}</td>
						<td colspan="15">{{perfil.plantilla_escolar}}</td>
						<td colspan="15">{%if perfil.director%}{{perfil.director}}{%endif%}</td>
						<td colspan="15">{%if perfil.foto_director%}<a href="{{perfil.foto_director.url}}">Ver</a>{%endif%}</td>
						</tr>
					</tbody>
					<thead>
						<tr>
							<th colspan="12">Telefono</th>
							<th colspan="12">Mail</th>
							<th colspan="12">Domicilio</th>
							<th colspan="12">Referencias</th>
							<th colspan="12">Foto de la entrada</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="12">{%if perfil.telefono%}{{perfil.telefono}}{%endif%}</td>
							<td colspan="12">{{escuela.email}}</td>
							<td colspan="12">{{perfil.domicilio}}</td>
							<td colspan="12">{%if perfil.referencias%}{{perfil.referencias}}{%endif%}</td>
							<td colspan="12">{%if perfil.foto_escuela%}<a href="{{perfil.foto_escuela.url}}">Ver</a>{%endif%}</td>
						</tr>
					</tbody>
					<thead>
						<tr>
							<th colspan="12">Municipio</th>
							<th colspan="12">Zona</th>
							<th colspan="12">Estado</th>
							<th colspan="12">Partida</th>
							<th colspan="12">Región</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="12">{{perfil.municipio.nombre}}</td>
							<td colspan="12">{{zona.nombre}}</td>
							<td colspan="12">{{entidad}}</td>
							<td colspan="12">{{entidad.partida.numero}}</td>
							<td colspan="12">{{region}}</td>
						</tr>
					</tbody>
					<thead>
						<tr>
							<th colspan="12">Coordenadas</th>
							<th colspan="12">Geolocalización</th>
							<th colspan="12">Tipo de conexión</th>
							<th colspan="12">Nombre de SSID (red WiFi)</th>
							<th colspan="12">Contraseña de SSID</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="12">{%if perfil.coordenadas%}{{perfil.coordenadas}}{%endif%}</td>
							<td colspan="12">{%if perfil.coordenadas%}<a href="{%url 'accounts:DetailViewMapa' perfil.pk%}" target="_blank">Ver mapa</a>{%endif%}</td>
							<td colspan="12">{%if perfil.conexion%}{{perfil.conexion}}{%endif%}</td>
							<td colspan="12">{%if perfil.SSID%}{{perfil.SSID}}{%endif%}</td>
							<td colspan="20">{%if perfil.clave_SSID%}{{perfil.clave_SSID}}{%endif%}</td>
						</tr>
					</tbody>
				</table>
			</div>

		{%endif%}
			<!-- Tabla de Contactos-->
			<h2>Contactos</h2>

			<div class="table-responsive text-center">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>Cargo</th>
							<th>Coordinador Estatal</th>
							<th>Superintendente</th>
							<th>Ejecutora</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="titulo-tabla">Nombre</td>
							<td>{{perfil.municipio.zona.entidad.coordinador_estatal.get_full_name}}</td>
							<td>{{perfil.municipio.zona.superintendente.get_full_name}}</td>
							<td>{%if sistemaBebedero.ejecutora%}{{sistemaBebedero.ejecutora}}{%else%}No aplica{%endif%}</td>
							</tr>
							<tr>
							<td class="titulo-tabla" ">Teléfono</td>
							<td>{{perfil.municipio.zona.entidad.coordinador_estatal.perfil.telefono}}</td>
							<td>{{perfil.municipio.zona.superintendente.perfil.telefono}}</td>
							<td>{%if sistemaBebedero.ejecutora.perfil.telefono%}{{sistemaBebedero.ejecutora.perfil.telefono}}{%else%}No aplica{%endif%}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<!--Tabla de cronologia-->
	<div class="row justify-content-center">
		<div class="col-lg-12 col-md-12 col-sm-12 col-12">
			<h2>Cronología general de la gestión, construcción, instalación y mantenimiento de un sistema bebedero</h2>
		</div>

		{%if request.user.perfil.tipo == "SI"  or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO"%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a class="thumbnail thumbnail-available container" href="{%url 'incidencias:CRViewIncidencias' perfil.pk%}">Bitacora de Incidencias</a>
		</div>
		{%endif%}

		{%if request.user.perfil.tipo == "Laboratorio" or request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if primerPrueba.aprobacion == "En espera"%} class=" thumbnail container thumbnail-prueba-en-espera" {%elif primerPrueba.aprobacion == "No aprobado"%} class=" thumbnail container thumbnail-prueba-no-aprobado" {%elif primerPrueba.aprobacion == "Aprobado"%} class=" thumbnail container thumbnail-prueba-aprobado" {%else%} class="thumbnail container" {%endif%} href="{%url 'pruebas:CRUViewPrimerPrueba' perfil.pk%}">Primer prueba de calidad 
			<br>Veredicto de Prueba de Calidad de Agua: {{primerPrueba.aprobacion}}</a>
		</div>
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%} {%if primerPrueba.aprobacion == "Aprobado"%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if inicioDeTrabajo%} class="thumbnail thumbnail-available container" {%else%} class="thumbnail container" {%endif%} href="{%url 'construccion:CRViewInicioDeTrabajo' perfil.pk%}">Inicio de trabajo</a>
		</div>
		{%endif%}
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if inicioDeTrabajo%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if visitaDeAcuerdo%} class="thumbnail thumbnail-available container" {%else%} class="thumbnail container" {%endif%} href="{%url 'visitas:CRViewVisitaDeAcuerdo' perfil.pk%}">Visita de acuerdos</a>
		</div>
		{%endif%}
		{%endif%}
		
		{%if request.user.perfil.tipo == "PQ" or request.user.perfil.tipo == "PM" or request.user.perfil.tipo == "Administrador"  or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if visitaDeAcuerdo%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if sistemaBebedero.no_trazabilidad%} class="thumbnail thumbnail-available container" {%else%} class="thumbnail container" {%endif%} href="{%url 'bebederos:UpdateViewBebedero' perfil.pk%}"> Asignación de componentes del Sistema bebedero</a>
		</div>
		{%endif%}
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "Ejecutora" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if sistemaBebedero.no_trazabilidad%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if evidenciaFinal%} class="thumbnail thumbnail-prueba-aprobado container" {%elif evidenciasConstruccion%} class="thumbnail thumbnail-prueba-en-espera" {%else%} class="thumbnail container" {%endif%} href="{%url 'construccion:CRViewEvidencias' perfil.pk%}">Evidencias de construccíón e Instalación de Mueble Bebedero{%if evidenciaFinal%}<br>Construcción finalizada{%else%}En proceso de construción o revisión{%endif%}</a>
		</div>
		{%endif%}
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Laboratorio"  or request.user.perfil.tipo == "PQ"  or request.user.perfil.tipo == "IMTA" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if evidenciaFinal%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if segundaPrueba.aprobacion == "En espera"%} class=" thumbnail container thumbnail-prueba-en-espera" {%elif segundaPrueba.aprobacion == "No aprobado"%} class=" thumbnail container thumbnail-prueba-no-aprobado" {%elif segundaPrueba.aprobacion == "Aprobado"%} class=" thumbnail container thumbnail-prueba-aprobado" {%else%} class="thumbnail container" {%endif%} href="{%url 'pruebas:CRUViewSegundaPrueba' perfil.pk%}">Segunda prueba de calidad<br>Veredicto de Prueba de Calidad de Agua: {{segundaPrueba.aprobacion}}</a>
		</div>
		{%endif%}
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if segundaPrueba.aprobacion == "Aprobado"%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if funcionamiento%} class="thumbnail thumbnail-available container" {%else%} class="thumbnail container" {%endif%} href="{%url 'visitas:CRViewInicioFuncionamiento' perfil.pk%}"> Inicio de funcionamiento</a>
		</div>
		{%endif%}
		{%endif%}

		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO"  or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela" or request.user.perfil.tipo == "PQ"%}
		{%if funcionamiento%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if mantenimientos.count == 24%} class="thumbnail thumbnail-available container"{%elif mantenimientos.count > 0 and mantenimientos.count < 24%} class="thumbnail thumbnail-prueba-en-espera container" {%elif mantenimientos.count == 0%} class="thumbnail container"{%endif%} href="{%url 'mantenimiento:CRViewMantenimientos' perfil.pk%}">Mantenimientos <br> {%if mantenimientos.count != 0%}Cantidad: {{mantenimientos.count}}{%endif%}</a>
		</div>
		{%endif%}
		{%endif%}


		{%if request.user.perfil.tipo == "SI" or request.user.perfil.tipo == "Administrador" or request.user.perfil.tipo == "CEO" or request.user.perfil.tipo == "INIFED" or request.user.perfil.tipo == "CEstatal" or request.user.perfil.tipo == "Escuela"%}
		{%if mantenimientos.count == 24%}
		<div class="col-lg-3 col-md-4 col-sm-6 col-12">
			<div class="dummy"></div>
			<a {%if actaEntrega%} class="thumbnail thumbnail-available container" {%else%} class="thumbnail container" {%endif%} href="{%url 'visitas:CRViewActaEntrega' perfil.pk%}"> Acta de entrega</a>
		</div>
		{%endif%}
		{%endif%}

	</div>

	<script>
	$('.popup').click(function (event) {
	event.preventDefault();
	window.open($(this).attr("href"), "popupWindow", "width=600,height=600,scrollbars=yes");
	});
	</script>

{%endblock content%}