{%extends 'base.html'%}

{%load bootstrap%}

{%block content%}
	
	<div class="row">
		<div class="col-12">

		{% for message in messages %}
	
			<div class="alert alert-{{ message.tags }}">{{ message }}</div>

		{% endfor %}

			<h1>Bitacora de Incidencias</h1>

			{% if request.get_full_path != "/incidencias/" %}
			<a href="{%url 'accounts:DetailViewEscuela' perfil.pk%}">Regresar</a>
			<h3>Escuela {{perfil.nivel_educativo}} "{{escuela.get_full_name}}"</h3>
			{%endif%}
		</div>
	</div>

	<div class="row">
		<div class="col-12">
			
			{% if request.get_full_path != "/incidencias/" %}

			<form action="." method="post" enctype="multipart/form-data">
				<h4>Registro</h4>	
				{%csrf_token%}
				{{NuevaIncidenciaForm | bootstrap}}
				<a href=""><input type="submit" value="Registrar"></a>		
			</form>

			{%endif%}

			<h4>Actuales</h4>
			<div class="table-responsive">
				<table class="table table-bordered">
					<thead>
						<th>Folio</th>
						<th>Etapa</th>
						<th>Descripci贸n</th>
						<th>Status</th>
						<th>Creaci贸n</th>
						<th>Prioridad</th>
						<th>Opciones</th>
					</thead>
					<tbody>
					
					{% for incidencia in incidenciasActuales%}

						<tr>
							<td>{{incidencia.pk}}</td>
							<td>{{incidencia.fase}}</td>
							<td>{{incidencia.descripcion}}</td>
							<td>{{incidencia.status}}</td>
							<td>{{incidencia.creacion}}</td>
							<td {%if incidencia.prioridad == "Baja"%}style="background-color: yellow" {%elif incidencia.prioridad == "Media"%}style="background-color: orange" {%elif incidencia.prioridad == "Alta"%}style="background-color: red"{%endif%}></td>
							<td><a href="{%url 'incidencias:UpdateViewIncidencia' incidencia.pk%}">Actualizar</a></td>
						</tr>

					{%empty%}

						<tr>
							<td colspan="7">No hay incidencias pendientes</td>
						</tr>

					{%endfor%}

					</tbody>
				</table>
			</div>

			<h4>Historial</h4>
			<div class="table-responsive">
				<table class="table table-bordered">
					<thead>
						<th>Folio</th>
						<th>Etapa</th>
						<th>Descripci贸n</th>
						<th>Status</th>
						<th>Creaci贸n</th>
					</thead>
					<tbody>
					
					{% for incidencia in historialIncidencias%}

						<tr>
							<td>{{incidencia.pk}}</td>
							<td>{{incidencia.fase}}</td>
							<td>{{incidencia.descripcion}}</td>
							<td>{{incidencia.solucion}}</td>
							<td>{{incidencia.creacion}}</td>
						</tr>

					{%empty%}

						<tr>
							<td colspan="6">Sin registro</td>
						</tr>

					{%endfor%}

					</tbody>
				</table>
			</div>
		</div>
	</div>
{%endblock content%}